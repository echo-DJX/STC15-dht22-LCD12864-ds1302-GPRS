C51 COMPILER V9.02   LCD12864                                                              09/27/2019 09:57:41 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN LCD12864.OBJ
COMPILER INVOKED BY: F:\Keil\C51\BIN\C51.EXE LCD12864.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "bsp.h"
   2          /**************************************************************
   3          
   4          
   5                //串/并方式控制
   6          /*******************************************************************
   7                        常量声明区
   8          ********************************************************************/       
   9          unsigned char code AC_TABLE[]={                                    //坐标编码
  10          0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,
  11          0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,
  12          0x88,0x89,0x8a,0x8b,0x8c,0x8d,0x8e,0x8f,
  13          0x98,0x99,0x9a,0x9b,0x9c,0x9d,0x9e,0x9f,
  14          };
  15          /****************************************************************
  16           声明：建议读者先查阅我们提供的12864word文档资料，理解12864定坐标的
  17           方式。                                                                                           
  18                        发送一个字节
  19          *****************************************************************/
  20          void SendByte(unsigned char Dbyte)
  21          {
  22   1              unsigned char i;
  23   1              for(i=0;i<8;i++)
  24   1              {
  25   2                      SCK = 0;
  26   2                      Dbyte=Dbyte<<1;
  27   2                      SID = CY;
  28   2                      SCK = 1;
  29   2                      SCK = 0;
  30   2              }
  31   1      }
  32          /**********************************************************
  33                        接收一个字节
  34          ***********************************************************/
  35          
  36          unsigned char ReceiveByte(void)
  37          {
  38   1              unsigned char i,temp1,temp2;
  39   1              temp1=temp2=0;
  40   1              for(i=0;i<8;i++)
  41   1              {
  42   2                      temp1=temp1<<1;
  43   2                      SCK = 0;
  44   2                      SCK = 1;                
  45   2                      SCK = 0;
  46   2                      if(SID) temp1++;
  47   2              }
  48   1              for(i=0;i<8;i++)
  49   1              {
  50   2                      temp2=temp2<<1;
  51   2                      SCK = 0;
  52   2                      SCK = 1;
  53   2                      SCK = 0;
  54   2                      if(SID) temp2++;
  55   2              }
C51 COMPILER V9.02   LCD12864                                                              09/27/2019 09:57:41 PAGE 2   

  56   1              return ((0xf0&temp1)+(0x0f&temp2));
  57   1      }
  58          /****************************************************************
  59                                检查忙状态
  60          ******************************************************************/
  61          void CheckBusy( void )
  62          {
  63   1              do SendByte(0xfc);     //11111,RW(1),RS(0),0
  64   1              while(0x80&ReceiveByte());
  65   1      }
  66          
  67          /******************************************************************
  68                     写一个字节的指令
  69          *******************************************************************/
  70          void WriteCommand( unsigned char Cbyte )
  71          {
  72   1              CS = 1;
  73   1              CheckBusy();
  74   1              SendByte(0xf8);          //11111,RW(0),RS(0),0
  75   1              SendByte(0xf0&Cbyte);
  76   1              SendByte(0xf0&Cbyte<<4);
  77   1              CS = 0;
  78   1      }
  79          /*************************************************************
  80                           写一个字节的数据
  81          **************************************************************/
  82          void WriteData( unsigned char Dbyte )
  83          {
  84   1              CS = 1;
  85   1              CheckBusy();
  86   1              SendByte(0xfa);          //11111,RW(0),RS(1),0
  87   1              SendByte(0xf0&Dbyte);
  88   1              SendByte(0xf0&Dbyte<<4);
  89   1              CS = 0;
  90   1      }
  91          
  92          /******************************************************************
  93                                   lcd初始化函数
  94          *******************************************************************/
  95          void LcmInit( void )
  96          {
  97   1           WriteCommand(0x30);
  98   1           WriteCommand(0x03);
  99   1           WriteCommand(0x0c);
 100   1           WriteCommand(0x01);
 101   1           WriteCommand(0x06);
 102   1      }
 103          
 104          /*******************************************************************************************************
 105                                           设定光标函数
 106          ********************************************************************************************************/
 107          void Location_xy_12864(unsigned char x,unsigned char y)
 108          {
 109   1              switch(x)
 110   1              {
 111   2                      case 0:
 112   2                              x=0x80;break;
 113   2                      case 1:
 114   2                              x=0x90;break;
 115   2                      case 2:
 116   2                              x=0x88;break;
 117   2                      case 3:
C51 COMPILER V9.02   LCD12864                                                              09/27/2019 09:57:41 PAGE 3   

 118   2                              x=0x98;break;
 119   2                      default:
 120   2                              x=0x80;
 121   2              }
 122   1              y=y&0x07;
 123   1              WriteCommand(0x30);
 124   1              WriteCommand(y+x);
 125   1              WriteCommand(y+x);
 126   1      
 127   1      }
 128          /***********************************************************************************
 129                            清除文本
 130          ************************************************************************************/
 131          void LcmClearTXT( void )
 132          {
 133   1              unsigned char i;
 134   1              WriteCommand(0x30);
 135   1              WriteCommand(0x80);
 136   1              for(i=0;i<64;i++)
 137   1              WriteData(0x20);
 138   1              Location_xy_12864(0,0);     
 139   1      }
 140          /**************************************************************************************
 141                             清除图片
 142          *****************************************************************************************/
 143          /*
 144          void LcmClearBMP( void )
 145          {
 146                  unsigned char i,j;
 147                  WriteCommand(0x34);
 148                  WriteCommand(0x36);
 149                  for(i=0;i<32;i++)
 150                  {
 151                          WriteCommand(0x80|i);
 152                          WriteCommand(0x80);
 153                          for(j=0;j<32;j++)
 154                          WriteData(0);
 155                  }
 156          }
 157          */
 158          //显示温度
 159          
 160          
 161          /****************************************************************************************
 162                                显示字符串
 163          *****************************************************************************************/
 164          void PutStr(unsigned char row,unsigned char col,unsigned char *puts)
 165          {    
 166   1              WriteCommand(0x30);
 167   1              WriteCommand(AC_TABLE[8*row+col]);
 168   1              while(*puts != '\0')
 169   1              {
 170   2                      if(col==8)
 171   2                      {
 172   3                              col=0;
 173   3                              row++;
 174   3                      }
 175   2                      if(row==4) row=0;
 176   2                      WriteCommand(AC_TABLE[8*row+col]);
 177   2                      WriteData(*puts);
 178   2                      puts++;
 179   2                      if(*puts != '\0')
C51 COMPILER V9.02   LCD12864                                                              09/27/2019 09:57:41 PAGE 4   

 180   2                      {
 181   3                              WriteData(*puts);
 182   3                              puts++;
 183   3                              col++;
 184   3                      }  
 185   2              }
 186   1      }
 187          
 188          void LineClear(unsigned char row)
 189          {   unsigned char i; 
 190   1              WriteCommand(0x30);
 191   1              WriteCommand(AC_TABLE[8*row]);
 192   1              for(i=0;i<16;i++)
 193   1                      WriteData(0x20);
 194   1      }
 195          
 196          
 197          
 198          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    394    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
