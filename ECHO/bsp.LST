C51 COMPILER V9.02   BSP                                                                   09/27/2019 09:57:40 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE BSP
OBJECT MODULE PLACED IN bsp.OBJ
COMPILER INVOKED BY: F:\Keil\C51\BIN\C51.EXE bsp.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"bsp.h"
   2          uchar code initTime[] = {0x50, 0x53, 0x19, 0x25, 0x09, 0x05, 0x19};      //初始化时间
   3          unsigned char INT_TIME[]={60,254,24,24,24,24,24,200,40,40};
   4          
   5          void BSP_INIT()
   6          {   
   7   1          int K;
   8   1              TIN3_LONG=0;
   9   1              command=0; //当前执行命令
  10   1          INT_count=0;//计时
  11   1        // UATR_INIT();
  12   1        //  ES=0;//关串口
  13   1        // AUXR = 0x14;                //T2为1T模式, 并启动定时器2    
  14   1          P0M0 = 0x00;
  15   1          P0M1 = 0x00;
  16   1          P1M0 = 0x00;
  17   1          P1M1 = 0x00;
  18   1          P2M0 = 0x00;
  19   1          P2M1 = 0x00;
  20   1          P3M0 = 0x00;
  21   1          P3M1 = 0x00;
  22   1          P4M0 = 0x00;
  23   1          P4M1 = 0x00;
  24   1          P5M0 = 0x00;
  25   1          P5M1 = 0x00;
  26   1              P6M0 = 0x00;
  27   1          P6M1 = 0x00;
  28   1          P7M0 = 0x00;
  29   1          P7M1 = 0x00;
  30   1              PSB=0;           //LCD串口通信方式
  31   1              LcmInit();             //LCD12864初始化                                                                                            
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                 
  32   1              LcmClearTXT();     //LCD12864清屏       
  33   1          DS1302_Initial();
  34   1              DS1302_Set1302(initTime);                       //设置DS1302的日期和时间
  35   1              for(K=0;K<7;K++)
  36   1                timenow[K]=0x00;
  37   1              Delay(100);
  38   1              LcmClearTXT();     //LCD12864清屏
  39   1      
  40   1      /*              UATR_INIT();
  41   1                      RH_SEND();
  42   1                      DelaySec(30);
  43   1                      SendString("AT+CGCLASS=\"B\"\r\n");
  44   1                      DelaySec(5);
  45   1                      SendString("AT+CGDCONT=1,\"IP\",\"CMNET\"\r\n");
  46   1                      DelaySec(5);
  47   1                      SendString("AT+CGATT=1\r\n");
  48   1                      DelaySec(5);
  49   1                  SendString("AT+CIPCSGP=1,\"CMNET\"\r\n");
  50   1                      DelaySec(5);
  51   1                      SendString("AT+CLPORT=\"TCP\",\"4001\"\r\n");
C51 COMPILER V9.02   BSP                                                                   09/27/2019 09:57:40 PAGE 2   

  52   1                      DelaySec(5);
  53   1                      SendString("AT+CIPSTART=\"TCP\",\"183.230.40.34\",\"80\"\r\n");
  54   1                      DelaySec(30);
  55   1                      SendString("AT+CIPSEND\r\n");
  56   1                      DelaySec(10);
  57   1                      SendString("POST /devices/548152733/datapoints?type=3 HTTP/1.1\r\n");
  58   1                      SendString("api-key:bVAsevzZT4dyobUj27iizubiL9Q=\r\n");
  59   1                      SendString("Host:api.heclouds.com\r\n");
  60   1              SendString("Content-Length:36\r\n\n");
  61   1            //  SendString("{\"temperature\":11.5,\"humidity\":51.7}\r\n");
  62   1                      SendString(SEND_HT);//发送温湿度过去
  63   1                      DelaySec(10);
  64   1                      SendString(buf5);
  65   1              //      ES=0;
  66   1              //      EA=0; */  
  67   1      }
  68          void SEND_SIM900()            //中断入口
  69          {
  70   1              unsigned char buf5[]={0x1A};
  71   1              unsigned char DD[8];
  72   1          INT_count++;
  73   1              sprintf(DD,"AA%d",INT_count);
  74   1              PutStr(0,0,DD);
  75   1              INT_count=INT_count%1000;
  76   1      
  77   1      /*    if(INT_count==INT_TIME[command])
  78   1              {
  79   1      
  80   1                      switch(command)
  81   1                      {
  82   1                        case 0://UATR_INIT();
  83   1                                      PutStr(0,0,"AAAA");     
  84   1                                       break;
  85   1                        case 1:SendString("AT+CGCLASS=\"B\"\r\n");
  86   1                                       break;
  87   1                        case 2:SendString("AT+CGDCONT=1,\"IP\",\"CMNET\"\r\n");
  88   1                                       break;
  89   1                        case 3:SendString("AT+CGATT=1\r\n");
  90   1                                       break;
  91   1                        case 4:SendString("AT+CIPCSGP=1,\"CMNET\"\r\n");
  92   1                                      break;  
  93   1                        case 5:SendString("AT+CLPORT=\"TCP\",\"4001\"\r\n");
  94   1                                      break;
  95   1                        case 6:SendString("AT+CIPSTART=\"TCP\",\"183.230.40.34\",\"80\"\r\n");
  96   1                                      break;
  97   1                        case 7:SendString("AT+CIPSEND\r\n");
  98   1                                      break;
  99   1                        case 8:RH_SEND();     
 100   1                                       SendString("POST /devices/548152733/datapoints?type=3 HTTP/1.1\r\n");
 101   1                                       SendString("api-key:bVAsevzZT4dyobUj27iizubiL9Q=\r\n");
 102   1                                       SendString("Host:api.heclouds.com\r\n");
 103   1                               SendString("Content-Length:36\r\n\n");
 104   1                               //  SendString("{\"temperature\":11.5,\"humidity\":51.7}\r\n");
 105   1                                       SendString(SEND_HT);//发送温湿度过去
 106   1                                       break;
 107   1                        case 9:SendString(buf5);
 108   1                                      break;                          
 109   1                      }
 110   1                      command++;
 111   1                      command=command%10;
 112   1              } */ 
 113   1      }
C51 COMPILER V9.02   BSP                                                                   09/27/2019 09:57:40 PAGE 3   

 114          
 115          
 116          void DelaySec(int sec)
 117          {
 118   1              unsigned int i , j= 0;
 119   1      
 120   1              for(i=0; i<sec; i++)
 121   1              {
 122   2                      for(j=0; j<65535; j++)
 123   2                      {       
 124   3                      }
 125   2              }
 126   1      }
 127          void Delay(uint t)
 128          {
 129   1              uint ii;
 130   1              for(ii=t;ii>0;ii--)
 131   1              DelayX10ms(1);  //ori=113
 132   1      }
 133          void DelayX10us(unsigned char n)                //@11.0592MHz
 134          {
 135   1              unsigned char i; 
 136   1              do
 137   1              { 
 138   2                _nop_();
 139   2                i = 25;
 140   2                while (--i);
 141   2              }while(n--);
 142   1      }
 143          
 144          void DelayXus(unsigned char n)     //@11.0592MHz
 145          {
 146   1          while (n--)
 147   1          {
 148   2              _nop_();
 149   2              _nop_();
 150   2                      _nop_();
 151   2          }
 152   1      }
 153          
 154          void Delay1ms()         //@11.0592MHz
 155          {
 156   1              unsigned char i, j;
 157   1      
 158   1              _nop_();
 159   1              _nop_();
 160   1              _nop_();
 161   1              i = 11;
 162   1              j = 190;
 163   1              do
 164   1              {
 165   2                      while (--j);
 166   2              } while (--i);
 167   1      }
 168          
 169          void DelayXms(unsigned char n)
 170          {
 171   1         unsigned char i;
 172   1         for(i=0;i<n;i++)
 173   1            Delay1ms(); 
 174   1      }       
 175          
C51 COMPILER V9.02   BSP                                                                   09/27/2019 09:57:40 PAGE 4   

 176          void DelayX10ms(unsigned char n)                //@11.0592MHz
 177          {
 178   1              unsigned char i, j;
 179   1        do
 180   1         {
 181   2              i = 108;
 182   2              j = 145;
 183   2              do
 184   2              {
 185   3                      while (--j);
 186   3              } while (--i);
 187   2         }while(--n);
 188   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    415    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =     10      17
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
